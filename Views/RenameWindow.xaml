<Window x:Class="TagNamer.Views.RenameWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:TagNamer.Controls"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        mc:Ignorable="d"
        ui:WindowHelper.UseModernWindowStyle="True"
        Height="480"
        Width="640"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterOwner"
        Title="규칙 설정">

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>   <!-- 규칙 입력 -->
            <RowDefinition Height="*"/>      <!-- 태그 목록 -->
            <RowDefinition Height="Auto"/>   <!-- 태그 생성 -->
        </Grid.RowDefinitions>

        <!-- 규칙 입력 -->
        <StackPanel Grid.Row="0">
            <StackPanel Margin="0,0,0,8" Orientation="Horizontal">
                <TextBlock Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                           Text="규칙을 입력하세요. " />
                <Image Source="{StaticResource HelpIcon}"
                       Width="14" Height="14"
                       Margin="0,0,0,0"
                       VerticalAlignment="Center"
                       Cursor="Help">
                    <Image.ToolTip>
                        <ToolTip Content="{Binding RuleGuildTooltip}"/>
                    </Image.ToolTip>
                </Image>
            </StackPanel>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <controls:FilterTextBox x:Name="RuleTextBox"
                                        AllowDrop="True"
                                        Margin="0,0,0,0"
                                        Height="32"
                                        VerticalContentAlignment="Center"
                                        FilterMode="Block"
                                        Filter="InvalidSpecial"
                                        Drop="RuleTextBox_Drop"
                                        PreviewDragOver="RuleTextBox_PreviewDragOver"
                                        Text="{Binding RuleFormat}" />
            </Grid>
        </StackPanel>

        <!-- 생성된 태그 목록 -->
        <StackPanel Grid.Row="1" Margin="0,8,0,0">
            <TextBlock FontSize="16" FontWeight="SemiBold" Text="생성된 태그 목록" Margin="0,0,0,8"/>
            <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="80">
                <ItemsControl Margin="0,-4,0,0" ItemsSource="{Binding TagManager.CreatedTags}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="4,4"
                                    Padding="8,4"
                                    Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                    BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Cursor="Hand"
                                    ToolTip="{Binding ToolTip}"
                                    MouseMove="TagItem_MouseMove"
                                    MouseRightButtonUp="TagItem_MouseRightButtonUp">
                                <TextBlock FontWeight="Medium" Text="{Binding TagName}" />
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </StackPanel>

        <!-- 태그 생성 -->
        <StackPanel Grid.Row="2" Margin="0,12,0,8">
            <Separator Margin="0,0,0,12" Background="{DynamicResource SystemControlForegroundBaseLowBrush}"/>
            <TextBlock FontSize="16" FontWeight="SemiBold" Text="태그 생성" Margin="0,0,0,8"/>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="140" />    <!-- 태그 선택 -->
                    <ColumnDefinition Width="*" />      <!-- 설명 -->
                    <ColumnDefinition Width="88" />     <!-- 생성 버튼 -->
                </Grid.ColumnDefinitions>

                <!-- 태그 선택 -->
                <ComboBox Grid.Row="0"
                          Grid.Column="0"
                          Margin="0,0,8,8"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Top"
                          ItemsSource="{Binding TagManager.TagTypes}"
                          SelectedItem="{Binding TagManager.SelectedTagType}" />

                <!-- 태그 설명 -->
                <TextBlock Grid.Row="0"
                           Grid.Column="1"
                           Margin="8,0,8,8"
                           VerticalAlignment="Top"
                           FontSize="12"
                           Foreground="Gray"
                           TextWrapping="Wrap"
                           Text="{Binding TagManager.TagTypeDescription}" />

                <!-- 생성 버튼 -->
                <Button Grid.Row="0"
                        Grid.RowSpan="2"
                        Grid.Column="2"
                        Width="80"
                        Height="32"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Content="생성"
                        Style="{StaticResource AccentButtonStyle}"
                        Command="{Binding TagManager.CreateTagCommand}" />

                <!-- 태그 옵션 -->
                <ContentControl Grid.Row="1"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Top"
                                Content="{Binding TagManager.SelectedTagType}">
                    <ContentControl.Resources>
                        <!-- Number 태그 -->
                        <DataTemplate x:Key="NumTemplate">
                            <StackPanel Orientation="Horizontal">
                                <StackPanel Margin="0,0,8,0">
                                    <TextBlock Text="시작 값" FontSize="10" Foreground="Gray" Margin="0,0,0,2"/>
                                    <controls:FilterTextBox Width="100"
                                                           VerticalContentAlignment="Center"
                                                           FilterMode="Allow"
                                                           Filter="Digits"
                                                           Text="{Binding DataContext.TagManager.OptionStartValue, RelativeSource={RelativeSource AncestorType=Window}}" />
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="자리 수" FontSize="10" Foreground="Gray" Margin="0,0,0,2"/>
                                    <controls:FilterTextBox Width="100"
                                                           VerticalContentAlignment="Center"
                                                           FilterMode="Allow"
                                                           Filter="Digits"
                                                           Text="{Binding DataContext.TagManager.OptionDigits, RelativeSource={RelativeSource AncestorType=Window}}" />
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                        <!-- AtoZ 태그 -->
                        <DataTemplate x:Key="AtoZTemplate">
                            <StackPanel Orientation="Horizontal">
                                <StackPanel Margin="0,0,8,0">
                                    <TextBlock Text="시작 값" FontSize="10" Foreground="Gray" Margin="0,0,0,2"/>
                                    <controls:FilterTextBox Width="100"
                                                           VerticalContentAlignment="Center"
                                                           FilterMode="Allow"
                                                           Filter="Alpha"
                                                           Text="{Binding DataContext.TagManager.OptionStartValue, RelativeSource={RelativeSource AncestorType=Window}}" />
                                </StackPanel>
                                <StackPanel Margin="0,0,8,0">
                                    <TextBlock Text="자리 수" FontSize="10" Foreground="Gray" Margin="0,0,0,2"/>
                                    <controls:FilterTextBox Width="100"
                                                           VerticalContentAlignment="Center"
                                                           FilterMode="Allow"
                                                           Filter="Digits"
                                                           Text="{Binding DataContext.TagManager.OptionDigits, RelativeSource={RelativeSource AncestorType=Window}}" />
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="소문자 수" FontSize="10" Foreground="Gray" Margin="0,0,0,2"/>
                                    <controls:FilterTextBox Width="100"
                                                           VerticalContentAlignment="Center"
                                                           FilterMode="Allow"
                                                           Filter="Digits"
                                                           Text="{Binding DataContext.TagManager.OptionLowerCount, RelativeSource={RelativeSource AncestorType=Window}}" />
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                        <!-- Today 태그 -->
                        <DataTemplate x:Key="DateTemplate">
                            <StackPanel Orientation="Horizontal">
                                <StackPanel Margin="0,0,4,0">
                                    <TextBlock Text="YYYY/YY(년) MM(월) DD(일)" FontSize="10" Foreground="Gray" Margin="0,0,0,2"/>
                                    <StackPanel Orientation="Horizontal">
                                        <ComboBox Width="70"
                                                  ItemsSource="{Binding DataContext.TagManager.DatePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                                  SelectedItem="{Binding DataContext.TagManager.OptionDatePart1, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <controls:FilterTextBox Width="40"
                                                                Margin="4,0"
                                                                Filter="ValidSpecial"
                                                                FilterMode="Allow"
                                                                FilterMaxLength="10"
                                                                VerticalContentAlignment="Center"
                                                                Text="{Binding DataContext.TagManager.OptionDateSep1, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <ComboBox Width="70"
                                                  ItemsSource="{Binding DataContext.TagManager.DatePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                                  SelectedItem="{Binding DataContext.TagManager.OptionDatePart2, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <controls:FilterTextBox Width="40"
                                                                Margin="4,0"
                                                                Filter="ValidSpecial"
                                                                FilterMode="Allow"
                                                                FilterMaxLength="10"
                                                                VerticalContentAlignment="Center"
                                                                Text="{Binding DataContext.TagManager.OptionDateSep2, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <ComboBox Width="70"
                                                  ItemsSource="{Binding DataContext.TagManager.DatePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                                  SelectedItem="{Binding DataContext.TagManager.OptionDatePart3, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                        <!-- Time.Now 태그 -->
                        <DataTemplate x:Key="TimeTemplate">
                            <StackPanel Orientation="Horizontal">
                                <StackPanel Margin="0,0,4,0">
                                    <TextBlock Text="HH(시) MM(분) SS(초)" FontSize="10" Foreground="Gray" Margin="0,0,0,2"/>
                                    <StackPanel Orientation="Horizontal">
                                        <ComboBox Width="70"
                                                  ItemsSource="{Binding DataContext.TagManager.TimePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                                  SelectedItem="{Binding DataContext.TagManager.OptionTimePart1, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <controls:FilterTextBox Width="40"
                                                                Margin="4,0"
                                                                Filter="ValidSpecial"
                                                                FilterMode="Allow"
                                                                FilterMaxLength="10"
                                                                VerticalContentAlignment="Center"
                                                                Text="{Binding DataContext.TagManager.OptionTimeSep1, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <ComboBox Width="70"
                                                  ItemsSource="{Binding DataContext.TagManager.TimePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                                  SelectedItem="{Binding DataContext.TagManager.OptionTimePart2, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <controls:FilterTextBox Width="40"
                                                                Margin="4,0"
                                                                Filter="ValidSpecial"
                                                                FilterMode="Allow"
                                                                FilterMaxLength="10"
                                                                VerticalContentAlignment="Center"
                                                                Text="{Binding DataContext.TagManager.OptionTimeSep2, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <ComboBox Width="70"
                                                  ItemsSource="{Binding DataContext.TagManager.TimePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                                  SelectedItem="{Binding DataContext.TagManager.OptionTimePart3, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                        <!-- Origin.split 태그 -->
                        <DataTemplate x:Key="OriginSplitTemplate">
                            <StackPanel Orientation="Horizontal">
                                <StackPanel Margin="0,0,8,0">
                                    <TextBlock Text="방향" FontSize="10" Foreground="Gray" Margin="0,0,0,2"/>
                                    <ToggleButton Width="100"
                                                  Height="32"
                                                  IsChecked="{Binding DataContext.TagManager.OptionSplitFromBack, RelativeSource={RelativeSource AncestorType=Window}}">
                                        <ToggleButton.Style>
                                            <Style TargetType="ToggleButton" BasedOn="{StaticResource DefaultToggleButtonStyle}">
                                                <Setter Property="Content" Value="앞에서부터"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter Property="Content" Value="뒤에서부터"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ToggleButton.Style>
                                    </ToggleButton>
                                </StackPanel>
                                <StackPanel Margin="0,0,8,0">
                                    <TextBlock Text="범위" FontSize="10" Foreground="Gray" Margin="0,0,0,2"/>
                                    <StackPanel Orientation="Horizontal">
                                         <controls:FilterTextBox Width="60"
                                                                Height="32"
                                                                VerticalContentAlignment="Center"
                                                                FilterMode="Allow"
                                                                Filter="Digits"
                                                                Text="{Binding DataContext.TagManager.OptionSplitStart, RelativeSource={RelativeSource AncestorType=Window}}" />
                                        <TextBlock Margin="4,0" VerticalAlignment="Center" Text="~" />
                                        <controls:FilterTextBox Width="60"
                                                                Height="32"
                                                                VerticalContentAlignment="Center"
                                                                FilterMode="Allow"
                                                                Filter="Digits"
                                                                Text="{Binding DataContext.TagManager.OptionSplitEnd, RelativeSource={RelativeSource AncestorType=Window}}" />
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="동작" FontSize="10" Foreground="Gray" Margin="0,0,0,2"/>
                                    <ToggleButton Width="100"
                                                  Height="32"
                                                  IsChecked="{Binding DataContext.TagManager.OptionSplitKeep, RelativeSource={RelativeSource AncestorType=Window}}">
                                        <ToggleButton.Style>
                                            <Style TargetType="ToggleButton" BasedOn="{StaticResource DefaultToggleButtonStyle}">
                                                <Setter Property="Content" Value="선택 삭제"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter Property="Content" Value="선택 남기기"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ToggleButton.Style>
                                    </ToggleButton>
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </ContentControl.Resources>
                    <ContentControl.Style>
                        <Style TargetType="ContentControl">
                            <Setter Property="ContentTemplate" Value="{x:Null}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[Number]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource NumTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[AtoZ]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource AtoZTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[Today]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource DateTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[Time.now]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource TimeTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[Origin.split]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource OriginSplitTemplate}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ContentControl.Style>
                </ContentControl>
            </Grid>
        </StackPanel>
    </Grid>
</Window>

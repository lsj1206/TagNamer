<Window x:Class="TagNamer.Views.RenameWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        mc:Ignorable="d"
        ui:WindowHelper.UseModernWindowStyle="True"
        Height="480"
        Width="720"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterOwner"
        Title="규칙 설정">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="80"/>    <!-- 규칙 입력 -->
            <RowDefinition Height="*"/>    <!-- 태그 목록 -->
            <RowDefinition Height="*"/>    <!-- 태그 생성 폼 -->
        </Grid.RowDefinitions>

        <!-- 1. 규칙 입력 섹션 -->
        <StackPanel Grid.Row="0">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="규칙을 입력하세요.  " Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                <TextBlock Text="설명 보기" FontSize="12" TextDecorations="Underline" Cursor="Help" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}">
                    <TextBlock.ToolTip>
                        <ToolTip Content="{Binding ruleGuildTooltip}"/>
                    </TextBlock.ToolTip>
                </TextBlock>
            </StackPanel>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox x:Name="RuleTextBox"
                         Text="{Binding RuleFormat, UpdateSourceTrigger=PropertyChanged}"
                         AllowDrop="True"
                         Drop="RuleTextBox_Drop"
                         PreviewDragOver="RuleTextBox_PreviewDragOver"
                         Height="32" VerticalContentAlignment="Center"
                         Margin="0,0,4,0"/>
                <Button Grid.Column="1" Content="적용" Width="80" Height="32"/>
            </Grid>
        </StackPanel>

        <!-- 2. 생성된 태그 목록 (드래그 소스) -->
        <GroupBox Grid.Row="1" Header="생성된 태그 목록" Margin="0,8,0,0">
            <ItemsControl Margin="0,-8,0,0" ItemsSource="{Binding TagManager.CreatedTags}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Margin="4,0"
                                Padding="8,4"
                                ToolTip="{Binding ToolTip}"
                                MouseMove="TagItem_MouseMove"
                                Cursor="Hand">
                            <TextBlock Text="{Binding DisplayName}" FontWeight="Medium"/>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </GroupBox>

        <!-- 3. 태그 생성 폼 -->
        <Border Grid.Row="1" VerticalAlignment="Bottom" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,0,1" Margin="0,0,0,-8"/>
        <GroupBox Grid.Row="2" Header="태그 생성" Margin="0,16,0,0">
            <Grid Margin="0,-8,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- 상단: 선택 | 설명 | 생성 -->
                    <RowDefinition Height="Auto"/> <!-- 하단: 옵션 -->
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="120"/> <!-- 태그 선택 -->
                    <ColumnDefinition Width="*"/>   <!-- 설명 -->
                    <ColumnDefinition Width="88"/>  <!-- 생성 버튼 -->
                </Grid.ColumnDefinitions>

                <!-- 1. 태그 선택 -->
                <ComboBox Grid.Row="0" Grid.Column="0"
                          ItemsSource="{Binding TagManager.TagTypes}"
                          SelectedItem="{Binding TagManager.SelectedTagType}"
                          Margin="0,0,8,8" VerticalAlignment="Center"
                          HorizontalAlignment="Stretch"/>

                <!-- 2. 설명 -->
                <TextBlock Grid.Row="0" Grid.Column="1"
                           Text="{Binding TagManager.TagTypeDescription}"
                           VerticalAlignment="Center"
                           Foreground="Gray"
                           Margin="8,0,8,8"/>

                <!-- 3. 생성 버튼 -->
                <Button Grid.Row="0" Grid.Column="2"
                        Content="생성"
                        Width="80" Height="32"
                        Command="{Binding TagManager.CreateTagCommand}"
                        HorizontalAlignment="Right" VerticalAlignment="Top"
                        Margin="0,0,0,8"/>

                <ContentControl Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
                                Content="{Binding TagManager.SelectedTagType}"
                                HorizontalAlignment="Stretch" VerticalAlignment="Top">
                    <ContentControl.Resources>
                        <DataTemplate x:Key="NumTemplate">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="자리 수 :" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                <TextBox Text="{Binding DataContext.TagManager.OptionDigits, RelativeSource={RelativeSource AncestorType=Window}}" Width="100" Margin="0,0,12,0" VerticalContentAlignment="Center"/>
                                <TextBlock Text="시작 값 :" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                <TextBox Text="{Binding DataContext.TagManager.OptionStartValue, RelativeSource={RelativeSource AncestorType=Window}}" Width="100" VerticalContentAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                        <DataTemplate x:Key="AlphaTemplate">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="자리 수 : " VerticalAlignment="Center" Margin="0,0,4,0"/>
                                <TextBox Text="{Binding DataContext.TagManager.OptionDigits, RelativeSource={RelativeSource AncestorType=Window}}" Width="100" Margin="0,0,12,0" VerticalContentAlignment="Center"/>
                                <TextBlock Text="시작 값 : " VerticalAlignment="Center" Margin="0,0,4,0"/>
                                <TextBox Text="{Binding DataContext.TagManager.OptionStartValue, RelativeSource={RelativeSource AncestorType=Window}}" Width="100" Margin="0,0,12,0" VerticalContentAlignment="Center"/>
                                <TextBlock Text="소문자 수 : " VerticalAlignment="Center" Margin="0,0,4,0"/>
                                <TextBox Text="{Binding DataContext.TagManager.OptionCase, RelativeSource={RelativeSource AncestorType=Window}}" Width="100" VerticalContentAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                        <DataTemplate x:Key="DateTemplate">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="형식 : " VerticalAlignment="Center" Margin="0,0,4,0"/>
                                <TextBox Text="{Binding DataContext.TagManager.OptionDateFormat, RelativeSource={RelativeSource AncestorType=Window}}" Width="200" VerticalContentAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                        <DataTemplate x:Key="TimeTemplate">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="형식 : " VerticalAlignment="Center" Margin="0,0,4,0"/>
                                <TextBox Text="{Binding DataContext.TagManager.OptionDateFormat, RelativeSource={RelativeSource AncestorType=Window}}" Width="200" VerticalContentAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </ContentControl.Resources>
                    <ContentControl.Style>
                        <Style TargetType="ContentControl">
                            <Setter Property="ContentTemplate" Value="{x:Null}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[Number]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource NumTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[AtoZ]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource AlphaTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[Today]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource DateTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[Time.Now]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource TimeTemplate}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ContentControl.Style>
                </ContentControl>
            </Grid>
        </GroupBox>
    </Grid>
</Window>

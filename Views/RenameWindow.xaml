<Window x:Class="TagNamer.Views.RenameWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:TagNamer.Controls"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        mc:Ignorable="d"
        ui:WindowHelper.UseModernWindowStyle="True"
        Height="480"
        Width="720"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterOwner"
        Title="규칙 설정">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>   <!-- 규칙 입력 -->
            <RowDefinition Height="*"/>    <!-- 태그 목록 -->
            <RowDefinition Height="160"/>    <!-- 태그 생성 -->
        </Grid.RowDefinitions>

        <!-- 규칙 입력 -->
        <StackPanel Grid.Row="0">
            <StackPanel Margin="0,0,0,8" Orientation="Horizontal">
                <TextBlock Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                           Text="규칙을 입력하세요. " />
                <TextBlock Cursor="Help"
                           FontSize="12"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                           Text="사용 방법"
                           TextDecorations="Underline">
                    <TextBlock.ToolTip>
                        <ToolTip Content="{Binding RuleGuildTooltip}"/>
                    </TextBlock.ToolTip>
                </TextBlock>
            </StackPanel>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <controls:FilterTextBox x:Name="RuleTextBox"
                                        AllowDrop="True"
                                        Margin="0,0,0,0"
                                        Height="32"
                                        VerticalContentAlignment="Center"
                                        FilterMode="Block"
                                        Filter="InvalidSpecial"
                                        Drop="RuleTextBox_Drop"
                                        PreviewDragOver="RuleTextBox_PreviewDragOver"
                                        Text="{Binding RuleFormat, UpdateSourceTrigger=PropertyChanged}" />
            </Grid>
        </StackPanel>

        <!-- 생성된 태그 목록 -->
        <GroupBox Grid.Row="1" Margin="0,8,0,0" Header="생성된 태그 목록">
            <ItemsControl Margin="0,-8,0,0" ItemsSource="{Binding TagManager.CreatedTags}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="4,0"
                                Padding="8,4"
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Cursor="Hand"
                                ToolTip="{Binding ToolTip}"
                                MouseMove="TagItem_MouseMove"
                                MouseRightButtonUp="TagItem_MouseRightButtonUp">
                            <TextBlock FontWeight="Medium" Text="{Binding DisplayName}" />
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </GroupBox>

        <!-- 태그 생성 -->
        <Border Grid.Row="1"
                Margin="0,0,0,-8"
                VerticalAlignment="Bottom"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="0,0,0,1" />
        <GroupBox Grid.Row="2" Margin="0,16,0,0" Header="태그 생성">
            <Grid Margin="0,-8,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="48"/>    <!-- 상단: 선택 | 설명 | 생성 (높이 고정) -->
                    <RowDefinition Height="Auto"/>    <!-- 하단: 옵션 -->
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="120" />    <!-- 태그 선택 -->
                    <ColumnDefinition Width="*" />      <!-- 설명 -->
                    <ColumnDefinition Width="88" />     <!-- 생성 버튼 -->
                </Grid.ColumnDefinitions>

                <!-- 태그 선택 -->
                <ComboBox Grid.Row="0"
                          Grid.Column="0"
                          Margin="0,0,8,8"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Top"
                          ItemsSource="{Binding TagManager.TagTypes}"
                          SelectedItem="{Binding TagManager.SelectedTagType}" />

                <!-- 태그 설명 -->
                <TextBlock Grid.Row="0"
                           Grid.Column="1"
                           Margin="8,0,8,8"
                           VerticalAlignment="Top"
                           FontSize="12"
                           Foreground="Gray"
                           Text="{Binding TagManager.TagTypeDescription}" />

                <!-- 생성 버튼 -->
                <Button Grid.Row="0"
                        Grid.Column="2"
                        Margin="0,0,0,8"
                        Width="80"
                        Height="32"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Content="생성"
                        Command="{Binding TagManager.CreateTagCommand}" />

                <!-- 태그 옵션 -->
                <ContentControl Grid.Row="1"
                                Grid.Column="0"
                                Grid.ColumnSpan="3"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Top"
                                Content="{Binding TagManager.SelectedTagType}">
                    <ContentControl.Resources>
                        <DataTemplate x:Key="NumTemplate">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Margin="0,0,4,0" VerticalAlignment="Center" Text="시작 값 :" />
                                <controls:FilterTextBox Width="100"
                                                        Margin="0,0,8,0"
                                                        VerticalContentAlignment="Center"
                                                        FilterMode="Allow"
                                                        Filter="Digits"
                                                        Text="{Binding DataContext.TagManager.OptionStartValue, RelativeSource={RelativeSource AncestorType=Window}}" />
                                <TextBlock Margin="0,0,4,0" VerticalAlignment="Center" Text="자리 수 :" />
                                <controls:FilterTextBox Width="100"
                                                        VerticalContentAlignment="Center"
                                                        FilterMode="Allow"
                                                        Filter="Digits"
                                                        Text="{Binding DataContext.TagManager.OptionDigits, RelativeSource={RelativeSource AncestorType=Window}}" />
                            </StackPanel>
                        </DataTemplate>
                        <DataTemplate x:Key="AtoZTemplate">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Margin="0,0,4,0" VerticalAlignment="Center" Text="시작 값 : " />
                                <controls:FilterTextBox Width="100"
                                                        Margin="0,0,8,0"
                                                        VerticalContentAlignment="Center"
                                                        FilterMode="Allow"
                                                        Filter="Alpha"
                                                        Text="{Binding DataContext.TagManager.OptionStartValue, RelativeSource={RelativeSource AncestorType=Window}}" />
                                <TextBlock Margin="0,0,4,0" VerticalAlignment="Center" Text="자리 수 : " />
                                <controls:FilterTextBox Width="100"
                                                        Margin="0,0,8,0"
                                                        VerticalContentAlignment="Center"
                                                        FilterMode="Allow"
                                                        Filter="Digits"
                                                        Text="{Binding DataContext.TagManager.OptionDigits, RelativeSource={RelativeSource AncestorType=Window}}" />
                                <TextBlock Margin="0,0,4,0" VerticalAlignment="Center" Text="소문자 수 : " />
                                <controls:FilterTextBox Width="100"
                                                        VerticalContentAlignment="Center"
                                                        FilterMode="Allow"
                                                        Filter="Digits"
                                                        Text="{Binding DataContext.TagManager.OptionLowerCount, RelativeSource={RelativeSource AncestorType=Window}}" />
                            </StackPanel>
                        </DataTemplate>
                        <DataTemplate x:Key="DateTemplate">
                            <StackPanel Orientation="Horizontal">
                                <ComboBox Width="70"
                                          ItemsSource="{Binding DataContext.TagManager.DatePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                          SelectedItem="{Binding DataContext.TagManager.OptionDatePart1, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                <controls:FilterTextBox Width="40"
                                                        Margin="4,0"
                                                        Filter="ValidSpecial"
                                                        FilterMode="Allow"
                                                        FilterMaxLength="3"
                                                        VerticalContentAlignment="Center"
                                                        Text="{Binding DataContext.TagManager.OptionDateSep1, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                <ComboBox Width="70"
                                          ItemsSource="{Binding DataContext.TagManager.DatePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                          SelectedItem="{Binding DataContext.TagManager.OptionDatePart2, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                <controls:FilterTextBox Width="40"
                                                        Margin="4,0"
                                                        Filter="ValidSpecial"
                                                        FilterMode="Allow"
                                                        FilterMaxLength="3"
                                                        VerticalContentAlignment="Center"
                                                        Text="{Binding DataContext.TagManager.OptionDateSep2, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                <ComboBox Width="70"
                                          ItemsSource="{Binding DataContext.TagManager.DatePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                          SelectedItem="{Binding DataContext.TagManager.OptionDatePart3, RelativeSource={RelativeSource AncestorType=Window}}"/>
                            </StackPanel>
                        </DataTemplate>
                        <DataTemplate x:Key="TimeTemplate">
                            <StackPanel Orientation="Horizontal">
                                <ComboBox Width="70"
                                          ItemsSource="{Binding DataContext.TagManager.TimePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                          SelectedItem="{Binding DataContext.TagManager.OptionTimePart1, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                <controls:FilterTextBox Width="40"
                                                        Margin="4,0"
                                                        Filter="ValidSpecial"
                                                        FilterMode="Allow"
                                                        FilterMaxLength="3"
                                                        VerticalContentAlignment="Center"
                                                        Text="{Binding DataContext.TagManager.OptionTimeSep1, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                <ComboBox Width="70"
                                          ItemsSource="{Binding DataContext.TagManager.TimePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                          SelectedItem="{Binding DataContext.TagManager.OptionTimePart2, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                <controls:FilterTextBox Width="40"
                                                        Margin="4,0"
                                                        Filter="ValidSpecial"
                                                        FilterMode="Allow"
                                                        FilterMaxLength="3"
                                                        VerticalContentAlignment="Center"
                                                        Text="{Binding DataContext.TagManager.OptionTimeSep2, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                <ComboBox Width="70"
                                          ItemsSource="{Binding DataContext.TagManager.TimePartTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                          SelectedItem="{Binding DataContext.TagManager.OptionTimePart3, RelativeSource={RelativeSource AncestorType=Window}}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ContentControl.Resources>
                    <ContentControl.Style>
                        <Style TargetType="ContentControl">
                            <Setter Property="ContentTemplate" Value="{x:Null}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[Number]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource NumTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[AtoZ]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource AtoZTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[Today]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource DateTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TagManager.SelectedTagType}" Value="[Time.now]">
                                    <Setter Property="ContentTemplate" Value="{StaticResource TimeTemplate}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ContentControl.Style>
                </ContentControl>
            </Grid>
        </GroupBox>
    </Grid>
</Window>
